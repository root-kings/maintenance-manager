extends components/layout.pug

block styles

block navtitle
    a.teal-text.brand-logo(href="/") CALIBRATION

block content
    //- .green.darken-2.hide-on-med-and-down
        .row
            .col.s12
                h4.header.light.white-text Dashboard

            //- .divider.green.darken-5

    #machinemodal.modal.modal-fixed-footer
        .modal-content

            .row
                h4.col.s12 Create machine
                form#createmachineform.col.s12(action='/machine/create', method='POST')
                    .row
                        .input-field.col.s12
                            input#name.validate(type="text", name="name")
                            label(for="name") Name
                    
                        .input-field.col.s6
                            input#interval.validate(type="text", name="interval")
                            label(for="interval") Checkup Interval
                        .input-field.col.s6
                            select(name="unit")
                                option(value="days") Days
                                option(value="months" selected) Months
                                option(value="years") Years    
                            //- label Unit
                        .input-field.col.s6
                            select(name="case")
                                option(value="open") Open
                                option(value="lte") LTE
                                option(value="cp") CP
                                option(value="gfr") GFR
                            label Case through

                        .input-field.col.s6
                            input#testing.validate(type="text", name="testing")
                            label(for="testing") What to test


                        .input-field.col.s12
                            input#remark(type="text", name="remark")
                            label(for="remark") Remarks


                    //- .row
                        .input-field.col.s4
                            input#sector.validate(type="text", name="sector")
                            label(for="sector") Sector
                        .input-field.col.s4
                            input#number.validate(type="number", name="number")
                            label(for="number") Number
                        .input-field.col.s4
                            input#shop.validate(type="text", name="shop")
                            label(for="shop") Shop
                    
                        
                   
                    .row
                        .input-field.col.s6
                            input#incharge.validate(type="text", name="incharge")
                            label(for="incharge") Incharge
                    
                        .input-field.col.s6
                            input#incharge-email.validate(type="email", name="incharge-email")
                            label(for="incharge-email") Incharge Email

                        .input-field.col.s6
                            input#incharge-phone.validate(type="tel", name="incharge-phone")
                            label(for="incharge-phone") Phone

                    .row
                        .input-field.col.s6
                            input#supplier.validate(type="text", name="supplier")
                            label(for="supplier") Supplier
                    
                        .input-field.col.s6
                            input#supplier-email.validate(type="email", name="supplier-email")
                            label(for="supplier-email") Supplier Email

                        .input-field.col.s6
                            input#supplier-phone.validate(type="tel", name="supplier-phone")
                            label(for="supplier-phone") Supplier Phone
                        .input-field.col.s6
                            input#supplier-reminder.validate(type="number", name="supplier-reminder", value="10", min="0")
                            label(for="supplier-reminder") Reminder before (days)

                    


        .modal-footer
            a.modal-close.waves-effect.waves-red.btn-flat.red-text(href="#!") Cancel
            a.btn.modal-close.waves-effect.waves-light.green.white-text(href="javascript:$('#createmachineform').submit();") Submit




    .fixed-action-btn
        // Modal Trigger
        a.waves-effect.waves-light.btn-floating.btn-large.red.modal-trigger(href="#machinemodal")
            i.material-icons.large add


    #upcoming
        //- .row
            .col.s12.m6(v-for="machine in machines")
                //- .card.rounded
                    .card-content
                        span.card-title.grey-text.text-darken-4 {{machine.name}}
                            a(href="#").orange-text
                                i.material-icons.right star

                        p {{machine.checkup.next}} 
                    .card-action
                        //- a.btn.btn-flat.btn-bordered.curvy(@click="markdone(machine._id)") Done
                        //-     i.material-icons.left done
                        //- a.btn.btn-flat.btn-bordered.curvy(@click="marklater(machine._id)") Later
                        //-     i.material-icons.left access_time
                        a.btn.btn-flat.btn-bordered.curvy(@click="viewMachine(machine._id)") View
                            i.material-icons.left visibility

                a(href="#" @click="viewMachine(machine._id)")
                    .card.rounded(v-bind:class="{'red darken-1 white-text': machine.soon }")
                        .card-content
                            span.card-title.text-darken-4 {{machine.name}}                            
                            p Next: {{machine.checkup.next}} 
                            p Days left: {{machine.soondays}} 


        //- .collection
            a.collection-item.avatar(href="#" v-for="machine in machines" @click="viewMachine(machine._id)" v-bind:class="{'firewatch white-text': machine.soon }")

                .row
                    span.col.s12.title.text-darken-4 {{machine.name}}                            

                    span.col.s6 Next: {{machine.checkup.next}} 
                    span.col.s6 {{machine.soondays}} days left


        ul.collapsible(v-once)
            li(v-for="machine in machines")
                .collapsible-header(v-bind:class="{'firewatch white-text': machine.soon }")
                    p.full-width.no-margin {{machine.name}} 
                        span.right Next: {{machine.checkup.next}} | {{machine.soondays}} days left
                .collapsible-body.card.no-padding.z-depth-0
                    .card-content
                        .row.no-margin
                            p.light.col.s12 # {{machine._id}}
                            
                            span.card-title.col.s12.grey-text.text-darken-4 {{machine.name}}

                            p.light.col.s12 Case through: {{machine.case}}
                                //- i.material-icons.right.red-text(@click='machineDelete(machine._id)') delete
                    .divider
                    .card-content
                        .row.no-margin
                            h5.col.s12.light Testing
                            
                            p.col.s12 Test: #[span.strong {{machine.testing}} ]

                            p.col.s4 Next 
                                br
                                | #[span.strong {{machine.checkup.next}} ]
                            p.col.s4 Last
                                br
                                | {{machine.checkup.last}}
                            p.col.s4 Frequency
                                br
                                | {{machine.checkup.interval.value}} {{machine.checkup.interval.unit}}
                            //- p.col.s6 {{machine.location.shop}} - {{machine.location.sector}}


                    .divider
                    .card-content
                        .row.no-margin        
                            h5.col.s12.light Supplier
                            
                            h6.col.s12.no-margin {{machine.supplier.name}}

                            p.col.s12 Email: {{machine.supplier.email}}
                            
                            p.col.s12 Phone: {{machine.supplier.phone}}
                            
                            p.col.s12 Reminder: {{machine.supplier.reminder}} days

                    .divider
                    .card-content
                        .row.no-margin        
                            h5.col.s12.light Incharge
                            
                            h6.col.s12.no-margin {{machine.incharge.name}}

                            p.col.s12 Email: {{machine.incharge.email}}
                            
                            p.col.s12 Phone: {{machine.incharge.phone}}
                            
                            


                    .card-action
                        .row.no-margin
                            h5.col.s12.light Remarks
                            p.col.s12.no-margin {{machine.remark}}

                            //- .input-field
                                input(type="text", name="remark", v-bind:id="'remark'+machine._id")
                                label(v-bind:for="'remark'+machine._id") Remark 

                            .input-field.col.s12
                                input.datepicker(type="text", name="date", v-bind:id="'date'+machine._id")
                                label(v-bind:for="'date'+machine._id") Add record date (yyyy-mm-dd)
                            .col.s12
                                a.btn.btn-flat.btn-bordered.curvy(@click="addRecord(machine._id)")
                                    i.material-icons add

                                //- a.btn.btn-flat.btn-bordered.curvy(@click="viewMachine(machine._id)") View
                                    i.material-icons visibility
                                a.btn.btn-flat.btn-bordered.curvy.modal-trigger(v-bind:href="'#record'+machine._id")
                                    i.material-icons visibility

                                a.btn.btn-flat.btn-bordered.curvy(@click='machineEdit(machine._id)')
                                    i.material-icons edit
                                
                                a.btn.btn-flat.red.white-text.btn-bordered.curvy.modal-trigger(@click='machineDelete(machine._id)')
                                    i.material-icons delete

                .modal.white(v-bind:id="'record'+machine._id")
                    ul.collection
                        li.collection-header
                            h5.light.center Past calibration record
                        li.collection-item(v-for="record in machine.checkup.history")
                            span {{moment(record).format('DD MMM YYYY')}}
                            a.secondary-content.red-text(@click="removeRecord(machine._id, record)")
                                i.material-icons close

block scripts
    script(src="/js/init/calibration.js")
